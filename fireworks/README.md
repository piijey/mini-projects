# matplotlib で花火を打ち上げる
夏は終わったけど、花火を見たくて matplotlib で作ってみました。

![暗い背景に、赤と黄色の点たちが同心円上に広がっていく。その後に青と黄色8の字上の点たちが広がっていく。](./fireworks.gif "花火")


## 動機とコードの解説
先日、打ち上げ花火を見ました。花火の多くが同心球を形作るように開きますが、先日見た花火の中には、珍しい凝った花火があり、上下や左右の方向に開くものがありました。同心球状の花火を量子力学のs軌道のようだと考えると、上下左右に開く花火は、p軌道やd軌道のように思えます。しかし、p軌道やd軌道は三次元的で複雑なので、ここでは単純化して実装しました。

### 原点からの距離
まず、原点から放出された花火の粒子が、時刻 $t$ に原点からの距離 $r(t)$ の位置にあると考えます。粒子は初速度 $v_0$ で放出された後、空気抵抗 $k'$ によって減速していくと考え、原点からの距離を次のように設定します。

$$
r(t) = \frac{v_0}{k'} + (1−e^{−k'/t})
$$

```python
r = v0/k_prime * (1 - np.exp(-k_prime * t))
```

### x, y 座標での位置
次に、粒子の位置 $x(t), y(t)$ を考えます。二次元上の全方向 $2π$ に36個の粒子を配置し、先ほど定義した原点からの距離 $r(t)$ を使用します。

x軸から見た粒子の角度を $a$ あるいは `angle` として、同心球状(s軌道のような)の花火での各粒子の位置を次のように設定します。

$$
\begin{align}
x(t) &= r(t)\cos(a)\\
y(t) &= r(t)\sin(a)
\end{align}
$$

```python
x = r * np.cos(angle)
y = r * np.sin(angle)
```

同様に、上下左右に開く(p軌道やd軌道のような)花火での各粒子の位置は、次のように設定します。

$$
\begin{align}
x(t) &= r(t)\sin(a)\\
y(t) &= r(t)\sin(a)\cos(a)
\end{align}
$$

```python
x = r * np.sin(angle)
y = r * np.sin(angle) * np.cos(angle)
```

各時刻におけるそれぞれの粒子をプロットすることで、花火の光を表現します。


## 準備と実行
Python, numpy, matplotlib, pillow をインストールします。

動作確認済みのバージョン:

- Python 3.8.12
- numpy 1.24.4
- matplotlib 3.6.0
- Pillow 10.0.1

実行します。

```sh
python fireworks.py
```
実行すると上記のGIFファイルが保存されます。

## さらなるアイデア
花火に面白さやリアリティを加える工夫が色々と思いつきますね。

- 点が消える瞬間にぼんやりと消えるような表現を加える
- 花火の位置を微妙にずらしたり、斜めにしたりする
- ハート型など、より凝ったデザインの花火を入れる
- 花火が開く前、打ち上がっていく様子を加える

ぜひみなさんも、おうちで花火を楽しみましょう。
